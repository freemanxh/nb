1、top
c 查看全路径
H 看线程

2、iostat 设备级I/O统计

iostat -x nvme0n1 1
iostat -p sda 1
iostat -p nvme0n1 1

 1. 设备饱和？
    %util > 80% 且持续 → 设备忙
    avgqu-sz > 1 → 请求排队
    
 2. I/O 延迟高？
    await > 10ms（HDD）或 > 1ms（SSD）→ 慢！
    r_await / w_await 单独高 → 读/写慢

检测 I/O 瓶颈（await > 10ms 或 %util > 80%）
iostat -x 1 | awk '$14>10 || $NF>80 {print "🚨 I/O 瓶颈！设备: " $1 ", await=" $14 "ms, %util=" $NF "%"}'

3、sar

sudo vim /etc/default/sysstat
ENABLED="true"
sudo systemctl enable sysstat
sudo systemctl start sysstat

#查看昨天 CPU 峰值（假设昨天是 13 号）
sar -u -f /var/log/sysstat/sa13 | awk 'NR>3 {max=($8>max)?$8:max} END {print "Yesterday max %idle: " max "%"}'
#检测 I/O 瓶颈（%iowait > 20%）
sar -u 1 10 | awk '$6>20 {print "🚨 I/O 瓶颈！%iowait=" $6 "% at " $1 " " $2}'
#查看内存使用趋势（今天）
sar -r | awk 'NR>3 {print $1, $5}' | column -t
#找出哪个时间段磁盘最忙（%util > 80%）
sar -d -p -f /var/log/sa/sa01 | awk '$12>80 {print "🚨 高负载！设备: " $2 ", 时间: " $1 " " $2 ", %util=" $12 "%"}'
#监控网卡流量（eth0）
sar -n DEV 1 | grep eth0

##、更改sar的日志采集频率
/etc/default/sysstat
ENABLED="true"

/etc/cron.d/sysstat
*/10 * * * * root /usr/lib/sysstat/sa1 1 1 
改为1分钟
*/1 * * * * root /usr/lib/sysstat/sa1 1 1

sudo systemctl reload cron 


# 自动清理旧数据 
编辑 /etc/logrotate.d/sysstat
/var/log/sa/sa* {
    weekly
    rotate 4
    compress
    missingok
    notifempty
}

4、lsof
lsof -p pid
lsof -u xuhui
lsof -i:port
#查看文件被谁占用
sudo lsof 文件路径
#找出所有监听端口的进程
sudo lsof -i -sTCP:LISTEN
#找出所有被删除但仍占用的文件
sudo lsof +L1
sudo lsof | grep deleted
#找出访问某个 IP 的所有连接
sudo lsof -i @8.8.8.8
#找出所有 TCP ESTABLISHED 连接
sudo lsof -i -sTCP:ESTABLISHED

5、fuser
查看谁在占用某个文件（解决“删不掉/改不了”）
fuser -v /var/log/nginx/access.log
找出并杀死占用日志文件的进程
sudo fuser -k /var/log/myapp.log
查看谁在占用某个端口（解决端口冲突）
fuser 80/tcp
fuser 3306/tcp
查看谁在占用某个设备/挂载点（解决“无法 umount”）
fuser -vm /mnt/usb
fuser -vm /dev/sdb1

# 1. 查看谁在用
fuser -vm /mnt/usb
# 2. 交互式杀死
sudo fuser -kmi /mnt/usb
# 3. 卸载
sudo umount /mnt/usb

在 Docker 容器中使用 fuser（需权限）
# 在宿主机上查看容器内进程占用
sudo fuser -v /var/lib/docker/overlay2/容器ID/merged/path/to/file

6、vmstat
vmstat -aw 1
vmstat 1

procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  0      0 123456  78900 456789    0    0    10    20  100 200 10  5 85  0  0
 
 r>cores 高 → CPU 忙；b>0 高 → 磁盘/网络卡
 si/so 持续 > 0 → 系统在疯狂换页 → 性能暴跌！
 wa 高 → 磁盘慢；us+sy 高且 id 低 → CPU 忙；st 高 → 虚拟机宿主机过载
 
 诊断 I/O 瓶颈
vmstat 1
# 观察：b > 0, wa > 20%, bi/bo 高
诊断内存不足
vmstat -a 1
# 观察：si/so > 0, free 持续下降, inactive 不增长
诊断 CPU 瓶颈
vmstat 1
# 观察：r > CPU核数 且 id < 20%

======================================================================

4、ssh-copy-id
ssh-copy-id "-p 22000 nameB@machineB"

5、增加user并加入sudo组
adduser xuhui
usermod -aG sudo xuhui
