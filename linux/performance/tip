1ã€top
c æŸ¥çœ‹å…¨è·¯å¾„
H çœ‹çº¿ç¨‹

2ã€iostat è®¾å¤‡çº§I/Oç»Ÿè®¡

iostat -x nvme0n1 1
iostat -p sda 1
iostat -p nvme0n1 1

 1. è®¾å¤‡é¥±å’Œï¼Ÿ
    %util > 80% ä¸”æŒç»­ â†’ è®¾å¤‡å¿™
    avgqu-sz > 1 â†’ è¯·æ±‚æ’é˜Ÿ
    
 2. I/O å»¶è¿Ÿé«˜ï¼Ÿ
    await > 10msï¼ˆHDDï¼‰æˆ– > 1msï¼ˆSSDï¼‰â†’ æ…¢ï¼
    r_await / w_await å•ç‹¬é«˜ â†’ è¯»/å†™æ…¢

æ£€æµ‹ I/O ç“¶é¢ˆï¼ˆawait > 10ms æˆ– %util > 80%ï¼‰
iostat -x 1 | awk '$14>10 || $NF>80 {print "ğŸš¨ I/O ç“¶é¢ˆï¼è®¾å¤‡: " $1 ", await=" $14 "ms, %util=" $NF "%"}'

3ã€sar

sudo vim /etc/default/sysstat
ENABLED="true"
sudo systemctl enable sysstat
sudo systemctl start sysstat

#æŸ¥çœ‹æ˜¨å¤© CPU å³°å€¼ï¼ˆå‡è®¾æ˜¨å¤©æ˜¯ 13 å·ï¼‰
sar -u -f /var/log/sysstat/sa13 | awk 'NR>3 {max=($8>max)?$8:max} END {print "Yesterday max %idle: " max "%"}'
#æ£€æµ‹ I/O ç“¶é¢ˆï¼ˆ%iowait > 20%ï¼‰
sar -u 1 10 | awk '$6>20 {print "ğŸš¨ I/O ç“¶é¢ˆï¼%iowait=" $6 "% at " $1 " " $2}'
#æŸ¥çœ‹å†…å­˜ä½¿ç”¨è¶‹åŠ¿ï¼ˆä»Šå¤©ï¼‰
sar -r | awk 'NR>3 {print $1, $5}' | column -t
#æ‰¾å‡ºå“ªä¸ªæ—¶é—´æ®µç£ç›˜æœ€å¿™ï¼ˆ%util > 80%ï¼‰
sar -d -p -f /var/log/sa/sa01 | awk '$12>80 {print "ğŸš¨ é«˜è´Ÿè½½ï¼è®¾å¤‡: " $2 ", æ—¶é—´: " $1 " " $2 ", %util=" $12 "%"}'
#ç›‘æ§ç½‘å¡æµé‡ï¼ˆeth0ï¼‰
sar -n DEV 1 | grep eth0

##ã€æ›´æ”¹sarçš„æ—¥å¿—é‡‡é›†é¢‘ç‡
/etc/default/sysstat
ENABLED="true"

/etc/cron.d/sysstat
*/10 * * * * root /usr/lib/sysstat/sa1 1 1 
æ”¹ä¸º1åˆ†é’Ÿ
*/1 * * * * root /usr/lib/sysstat/sa1 1 1

sudo systemctl reload cron 


# è‡ªåŠ¨æ¸…ç†æ—§æ•°æ® 
ç¼–è¾‘ /etc/logrotate.d/sysstat
/var/log/sa/sa* {
    weekly
    rotate 4
    compress
    missingok
    notifempty
}
