1、top
c 查看全路径
H 看线程

2、iostat 设备级I/O统计

iostat -x nvme0n1 1
iostat -p sda 1
iostat -p nvme0n1 1

 1. 设备饱和？
    %util > 80% 且持续 → 设备忙
    avgqu-sz > 1 → 请求排队
    
 2. I/O 延迟高？
    await > 10ms（HDD）或 > 1ms（SSD）→ 慢！
    r_await / w_await 单独高 → 读/写慢

检测 I/O 瓶颈（await > 10ms 或 %util > 80%）
iostat -x 1 | awk '$14>10 || $NF>80 {print "🚨 I/O 瓶颈！设备: " $1 ", await=" $14 "ms, %util=" $NF "%"}'

3、sar

sudo vim /etc/default/sysstat
ENABLED="true"
sudo systemctl enable sysstat
sudo systemctl start sysstat

#查看昨天 CPU 峰值（假设昨天是 13 号）
sar -u -f /var/log/sysstat/sa13 | awk 'NR>3 {max=($8>max)?$8:max} END {print "Yesterday max %idle: " max "%"}'
#检测 I/O 瓶颈（%iowait > 20%）
sar -u 1 10 | awk '$6>20 {print "🚨 I/O 瓶颈！%iowait=" $6 "% at " $1 " " $2}'
#查看内存使用趋势（今天）
sar -r | awk 'NR>3 {print $1, $5}' | column -t
#找出哪个时间段磁盘最忙（%util > 80%）
sar -d -p -f /var/log/sa/sa01 | awk '$12>80 {print "🚨 高负载！设备: " $2 ", 时间: " $1 " " $2 ", %util=" $12 "%"}'
#监控网卡流量（eth0）
sar -n DEV 1 | grep eth0

##、更改sar的日志采集频率
/etc/default/sysstat
ENABLED="true"

/etc/cron.d/sysstat
*/10 * * * * root /usr/lib/sysstat/sa1 1 1 
改为1分钟
*/1 * * * * root /usr/lib/sysstat/sa1 1 1

sudo systemctl reload cron 


# 自动清理旧数据 
编辑 /etc/logrotate.d/sysstat
/var/log/sa/sa* {
    weekly
    rotate 4
    compress
    missingok
    notifempty
}
