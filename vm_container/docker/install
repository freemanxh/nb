1ã€ubuntu server å®‰è£…ï¼š

docker_install.sh

#!/bin/bash
set -e
sudo apt update && sudo apt upgrade -y
if [ "$1" == "old" ]; then
        echo "ç°åœ¨delete old docker"
        sudo apt-get remove -y docker docker-engine docker.io containerd runc
fi

sudo apt-get install -y apt-transport-https ca-certificates curl software-properties-common gnupg lsb-release

echo "ğŸ”‘ æ·»åŠ  Docker GPG å¯†é’¥ï¼ˆç°ä»£æ–¹å¼ï¼‰..."
curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
echo "ğŸ“¥ æ·»åŠ  Docker APT æº..."
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null


sudo apt update

apt-cache madison docker-ce
echo "ğŸ“Œ è¯·è¾“å…¥è¦å®‰è£…çš„ Docker ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼š5:26.1.4-1~ubuntu.22.04~jammyï¼‰ï¼š"
read VS

sudo apt-get install -y docker-ce=$VS docker-ce-cli=$VS containerd.io docker-compose-plugin docker-compose

echo "âš™ï¸  é…ç½® Docker daemonï¼ˆé•œåƒåŠ é€Ÿ + æ—¥å¿— + cgroupï¼‰..."
sudo mkdir -p /etc/docker
#cgroupdriver=systemdï¼šä¸ Kubernetes å…¼å®¹ï¼ˆé‡è¦ï¼ï¼‰
cat <<EOF | sudo tee /etc/docker/daemon.json
{
  "registry-mirrors": [
    "https://docker.1ms.run",
    "https://docker.xuanyuan.me",
    "https://docker.aityp.com",
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com",
    "https://mirror.baidubce.com"
  ],
  "exec-opts": ["native.cgroupdriver=systemd"],
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "100m",
    "max-file": "3"
  },
  "default-runtime": "runc",                 
  "default-address-pools": [                 
    {
      "base": "10.200.0.0/16",
      "size": 24
    }
  ],
  "storage-driver": "overlay2",
  "features": {
    "buildkit": true
  }
}
EOF

sudo systemctl enable docker --now
sudo systemctl restart docker

echo "ğŸ‘¥ å°†å½“å‰ç”¨æˆ·åŠ å…¥ docker ç»„..."
sudo groupadd docker 2>/dev/null || true
sudo usermod -aG docker $USER

echo "âœ… å®‰è£…å®Œæˆï¼"
echo "âš ï¸  è¯·é‡æ–°ç™»å½•ç³»ç»Ÿï¼Œæˆ–è¿è¡Œ 'su - $USER' ä½¿ docker ç»„ç”Ÿæ•ˆ"
echo "ğŸ§ª éªŒè¯å®‰è£…ï¼š"
echo "   docker --version"
echo "   docker compose version"
echo "   docker run --rm hello-world"
